<div class="project-list-container">
  <header class="page-header">
    <h1>Project Scheduler</h1>
    <p class="subtitle">Manage and track development projects</p>
  </header>

  <div class="controls">
    <div class="search-box">
      <input 
        type="text" 
        [(ngModel)]="searchKeyword"
        (ngModelChange)="onSearchChange()"
        placeholder="Search projects..."
        class="search-input"
      />
    </div>

    <div class="filter-box">
      <select 
        [(ngModel)]="selectedStatus"
        (ngModelChange)="onStatusChange()"
        class="status-select"
      >
        <option *ngFor="let status of statuses" [value]="status.value">
          {{status.label}}
        </option>
      </select>
    </div>

    <div class="stats">
      <span class="stat-item">
        Total: <strong>{{projects.length}}</strong>
      </span>
      <span class="stat-item">
        Showing: <strong>{{filteredProjects.length}}</strong>
      </span>
    </div>
  </div>

  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    <p>Loading projects...</p>
  </div>

  <div *ngIf="!loading && filteredProjects.length === 0" class="no-results">
    <p>No projects found.</p>
  </div>

  <div *ngIf="!loading && filteredProjects.length > 0" class="table-container">
    <table class="projects-table">
      <thead>
        <tr>
          <th class="col-project sortable" (click)="sortBy('projectName')">
            Project Name <span class="sort-icon">{{getSortIcon('projectName')}}</span>
          </th>
          <th class="col-status sortable" (click)="sortBy('status')">
            Status <span class="sort-icon">{{getSortIcon('status')}}</span>
          </th>
          <th class="col-level sortable" (click)="sortBy('level')">
            Level <span class="sort-icon">{{getSortIcon('level')}}</span>
          </th>
          <th class="col-date sortable" (click)="sortBy('startDate')">
            Start Date <span class="sort-icon">{{getSortIcon('startDate')}}</span>
          </th>
          <th class="col-date sortable" (click)="sortBy('qaReadyDate')">
            QA Ready Date <span class="sort-icon">{{getSortIcon('qaReadyDate')}}</span>
          </th>
          <th class="col-date sortable" (click)="sortBy('targetProdDate')">
            Target Prod Date <span class="sort-icon">{{getSortIcon('targetProdDate')}}</span>
          </th>
          <th class="col-team sortable" (click)="sortBy('primaryTeam')">
            Primary Team <span class="sort-icon">{{getSortIcon('primaryTeam')}}</span>
          </th>
          <th class="col-priority sortable" (click)="sortBy('priority')">
            Priority <span class="sort-icon">{{getSortIcon('priority')}}</span>
          </th>
          <th class="col-urgency sortable" (click)="sortBy('urgency')">
            Urgency <span class="sort-icon">{{getSortIcon('urgency')}}</span>
          </th>
          <th class="col-hours sortable" (click)="sortBy('devHours')">
            Dev Hours <span class="sort-icon">{{getSortIcon('devHours')}}</span>
          </th>
          <th class="col-hours sortable" (click)="sortBy('wfHours')">
            WF Hours <span class="sort-icon">{{getSortIcon('wfHours')}}</span>
          </th>
          <th class="col-developers sortable" (click)="sortBy('developers')">
            Assigned Developers <span class="sort-icon">{{getSortIcon('developers')}}</span>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr 
          *ngFor="let project of filteredProjects" 
          class="project-row"
        >
          <td class="col-project">
            <div class="project-name" [title]="project.projectName">
              {{project.projectName}}
            </div>
          </td>
          
          <td class="col-status">
            <span class="status-badge" [ngClass]="getStatusClass(project.status)">
              {{project.status || '-'}}
            </span>
          </td>
          
          <td class="col-level">
            <span class="level-value">{{project.level || '-'}}</span>
          </td>
          
          <td class="col-date">
            <span class="date-value">
              {{project.startDate ? (project.startDate | date:'MMM d, y') : '-'}}
            </span>
          </td>
          
          <td class="col-date">
            <span class="date-value">
              {{project.qaReadyDate ? (project.qaReadyDate | date:'MMM d, y') : '-'}}
            </span>
          </td>
          
          <td class="col-date">
            <span class="date-value">
              {{project.targetProdDate ? (project.targetProdDate | date:'MMM d, y') : '-'}}
            </span>
          </td>
          
          <td class="col-team">
            <span class="team-name">{{getTeamName(project.primaryTeamId)}}</span>
          </td>
          
          <td class="col-priority">
            <span class="priority-badge" [ngClass]="getPriorityClass(project.priority)">
              {{project.priority !== null && project.priority !== undefined ? project.priority : '-'}}
            </span>
          </td>
          
          <td class="col-urgency">
            <span class="urgency-badge" [ngClass]="getUrgencyClass(project.urgency)">
              {{project.urgency !== null && project.urgency !== undefined ? project.urgency : '-'}}
            </span>
          </td>
          
          <td class="col-hours">
            <span class="hours-value">{{project.devHours || 0}}</span>
          </td>
          
          <td class="col-hours">
            <span class="hours-value">{{project.wfHours || 0}}</span>
          </td>
          
          <td class="col-developers">
            <div class="developers-list" *ngIf="project.assignments && project.assignments.length > 0">
              <div class="developer-item" *ngFor="let assignment of project.assignments">
                <span class="developer-name">
                  {{assignment.developer?.firstName}} {{assignment.developer?.lastName}}
                </span>
                
                <!-- View Mode -->
                <div *ngIf="!isEditing(assignment.assignmentsId)" class="developer-dates view-mode">
                  <span class="date-range" (click)="startEditingDates(assignment)">
                    <span *ngIf="assignment.startDate || assignment.endDate">
                      {{assignment.startDate ? (assignment.startDate | date:'MMM d, y') : 'No start'}}
                      <span class="date-separator">→</span>
                      {{assignment.endDate ? (assignment.endDate | date:'MMM d, y') : 'No end'}}
                    </span>
                    <span *ngIf="!assignment.startDate && !assignment.endDate" class="no-dates">
                      (No dates set)
                    </span>
                    <span class="edit-icon">✏️</span>
                  </span>
                </div>
                
                <!-- Edit Mode -->
                <div *ngIf="isEditing(assignment.assignmentsId)" class="developer-dates edit-mode">
                  <div class="date-inputs">
                    <input 
                      type="date" 
                      [(ngModel)]="editedDates[assignment.assignmentsId!].start"
                      class="date-input"
                      placeholder="Start Date">
                    <span class="date-separator">→</span>
                    <input 
                      type="date" 
                      [(ngModel)]="editedDates[assignment.assignmentsId!].end"
                      class="date-input"
                      placeholder="End Date">
                  </div>
                  <div class="edit-actions">
                    <button 
                      (click)="saveAssignmentDates(assignment)" 
                      class="btn-save" 
                      title="Save"
                      [disabled]="isSaving(assignment.assignmentsId)">
                      <span *ngIf="!isSaving(assignment.assignmentsId)">✓ Save</span>
                      <span *ngIf="isSaving(assignment.assignmentsId)">Saving...</span>
                    </button>
                    <button 
                      (click)="cancelEdit()" 
                      class="btn-cancel" 
                      title="Cancel"
                      [disabled]="isSaving(assignment.assignmentsId)">
                      ✗ Cancel
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <span class="no-developers" *ngIf="!project.assignments || project.assignments.length === 0">
              No developers assigned
            </span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
